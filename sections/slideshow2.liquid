<!-- filepath: sections/banner-with-countdown.liquid -->
{%- assign block = section.blocks.first -%}
{%- assign img = block.settings.image_desktop -%}
{%- assign m_img = block.settings.image_mobile -%}
{%- assign overlay_parts = block.settings.overlay_position | split: ' ' -%}
{%- assign justify = overlay_parts[0] | replace: 'justify-', '' -%}
{%- assign align = overlay_parts[1] | replace: 'items-', '' -%}

<style>
  #{{ section.id }}-banner {
    position: relative;
    width: 100%;
    overflow: hidden;
    display: flex;
    min-height: {{ section.settings.fixed_height_desktop | default: 400 }}px;
    justify-content: {{ justify }};
    align-items: {{ align }};
    {% if section.settings.color_scheme == 'white' or section.settings.color_scheme == 'default' %}
      background: #fff;
    {% else %}
      background: var(--color-bg, #f5f5f5);
    {% endif %}
  }
  @media (max-width: 749px) {
    #{{ section.id }}-banner {
      min-height: {{ section.settings.fixed_height_mobile | default: 250 }}px;
    }
  }
  #{{ section.id }}-banner .banner-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    top: 0; left: 0;
    z-index: 1;
  }
  #{{ section.id }}-banner .banner-overlay {
    position: relative;
    z-index: 2;
    max-width: 900px;
    padding: 2rem 1rem;
    {% comment %} background: rgba(0,0,0,0.3); {% endcomment %}
    display : flex;
    flex-direction: column;
    {% comment %} align-items: {{ align }}; {% endcomment %}
  }
  #{{ section.id }}-banner .banner-overlay.text-start {
    text-align: left;
  }
  #{{ section.id }}-banner .banner-overlay.text-center {
    text-align: center;
  }
  #{{ section.id }}-banner .banner-overlay.text-end {
    text-align: right;
  }
  #{{ section.id }}-banner .banner-heading {
    font-size: 3rem;
    font-weight: bold;
    {% if block.settings.use_custom_colors and block.settings.count_color != blank %}
      color: {{ block.settings.count_color }};
    {% else %}
      color: #fff;
    {% endif %}
    margin-bottom: 1rem;
  }
  #{{ section.id }}-banner .banner-subheading {
    font-size: 1.8rem;
    color: #fff;
    margin-bottom: 0.5rem;
  }
  #{{ section.id }}-banner .banner-countdown {
    margin: 1.5rem 0;
    display: flex;
    gap: 1rem;
    justify-content: center;
    font-family: 'Allerta Stencil', 'Roboto Flex', sans-serif;
  }
  #{{ section.id }}-banner .countdown__number {
    {% if block.settings.use_custom_colors and block.settings.bg_grad != blank %}
      background: {{ block.settings.bg_grad }};
    {% else %}
      background: {{ block.settings.bg_color }};
    {% endif %}
    color: {{ block.settings.count_color }};
    padding: 0.5em 1em;
    border-radius: 0.5em;
    font-size: 2rem;
    min-width: 2.5em;
    text-align: center;
  }
  #{{ section.id }}-banner .banner-btn {
    margin-top: 1rem;
    padding: 0.75em 2em;
    font-size: 1rem;
    background: #fff;
    color: #222;
    border: none;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.2s, color 0.2s;
  }
  #{{ section.id }}-banner .banner-overlay.text-end .banner-btn {
    margin: 1rem 0 0 auto;
  }
  #{{ section.id }}-banner .banner-overlay.text-center .banner-btn {
    margin: 1rem auto 0 auto;
  }
  #{{ section.id }}-banner .banner-overlay.text-start .banner-btn {
    margin: 1rem auto 0 0;
  }
  #{{ section.id }}-banner .banner-btn:hover {
    background: #222;
    color: #fff;
  }
</style>

<!-- Load the JS file ONCE at the top or bottom of the section -->
<script src="{{ 'countdown-timer.js' | asset_url }}" defer="defer"></script>

<div id="{{ section.id }}-banner">
  {%- if img != blank -%}
    <img
      class="banner-img"
      src="{{ img | image_url: width: 1600 }}"
      alt="{{ block.settings.heading | escape }}"
      width="1600"
      height="auto"
    >
  {%- endif -%}
  <div class="banner-overlay {{ block.settings.overlay_text_align }} color-{{ block.settings.color_scheme }}">
    {%- if block.settings.subheading != blank -%}
      <div class="banner-subheading">{{ block.settings.subheading }}</div>
    {%- endif -%}
    {%- if block.settings.heading != blank -%}
      <div class="banner-heading {{ block.settings.heading_size }}">{{ block.settings.heading }}</div>
    {%- endif -%}
    {%- if block.settings.text != blank -%}
      <div class="banner-text rte">{{ block.settings.text }}</div>
    {%- endif -%}

    {%- for block in section.blocks -%}
      {%- if block.settings.countdown_show and block.settings.countdown_end_date != blank -%}
        {% if block.settings.use_custom_colors %}
          <style>
            #{{ section.id }}_{{ forloop.index }} .countdown__number {
              color: {{ block.settings.count_color }};
              background: {{ block.settings.bg_color }};
            }
            {%- if block.settings.bg_grad != blank -%}
            #{{ section.id }}_{{ forloop.index }} .countdown__number {
              background: {{ block.settings.bg_grad }};
            }
            {%- endif -%}
          </style>
        {% endif %}
        <div id="{{ section.id }}_{{ forloop.index }}" class="banner-countdown">
          <countdown-timer data-end-date="{{ block.settings.countdown_end_date }}{% if block.settings.countdown_end_time != blank %}T{{ block.settings.countdown_end_time }}{% endif %}">
            <span class="countdown__number js-days">0</span>
            <span class="countdown__number js-hours">0</span>
            <span class="countdown__number js-mins">0</span>
            <span class="countdown__number js-secs">0</span>
          </countdown-timer>
          {%- if block.settings.countdown_end_text != blank -%}
            <div class="countdown-end-text{% if block.settings.enlarge_end_text %} countdown-large-endtext{% endif %}">
              {{ block.settings.countdown_end_text }}
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}
    {%- endfor -%}

    {%- if block.settings.button_1_label != blank and block.settings.button_1_link != blank -%}
      <a href="{{ block.settings.button_1_link }}" class="banner-btn">{{ block.settings.button_1_label }}</a>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Countdown banner",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "height_mode",
      "label": "Image height",
      "options": [
        {
          "value": "auto",
          "label": "Height of first image"
        },
        {
          "value": "fixed",
          "label": "Fixed height (set below)"
        },
        {
          "value": "screen",
          "label": "Full screen height"
        }
      ],
      "default": "auto"
    },
    {
      "type": "range",
      "id": "fixed_height_desktop",
      "min": 400,
      "max": 750,
      "step": 10,
      "unit": "px",
      "label": "Minimum fixed height on large screens",
      "default": 600
    },
    {
      "type": "range",
      "id": "fixed_height_mobile",
      "min": 250,
      "max": 500,
      "step": 10,
      "unit": "px",
      "label": "Minimum fixed height on mobile",
      "default": 350
    },
    {
      "type": "checkbox",
      "id": "mobile_stacked",
      "label": "Show text below image on mobile",
      "info": "Does not apply to \"Full screen height\".",
      "default": false
    },

    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "options": [
        {
          "value": "white",
          "label": "White"
        },
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "1",
          "label": "Scheme 1"
        },
        {
          "value": "2",
          "label": "Scheme 2"
        },
        {
          "value": "3",
          "label": "Scheme 3"
        }
      ],
      "default": "white"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Make section background full width",
      "default": true
    },
    {
      "type": "color",
      "id": "tint_color",
      "label": "Image tint color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "tint_opacity",
      "min": 0,
      "max": 60,
      "step": 5,
      "unit": "%",
      "label": "Image tint opacity",
      "default": 40
    }
  ],
  "blocks": [
    {
      "type": "banner",
      "name": "Banner",
      "limit": 5,
      "settings": [
        {
          "type": "image_picker",
          "id": "image_desktop",
          "label": "Image",
          "info": "For best results, use a landscape shaped image with a minimum width of 3200px."
        },
        {
          "type": "image_picker",
          "id": "image_mobile",
          "label": "Mobile image (optional)",
          "info": "For best results, use a square or portrait shaped image. If no mobile image is provided, the large screen image will be used."
        },
        {
          "type": "header",
          "content": "Text overlay"
        },
        {
          "type": "select",
          "id": "overlay_position",
          "label": "Overlay position",
          "options": [
            {
              "value": "justify-start items-start",
              "label": "Top left"
            },
            {
              "value": "justify-center items-start",
              "label": "Top center"
            },
            {
              "value": "justify-end items-start",
              "label": "Top right"
            },
            {
              "value": "justify-start items-center",
              "label": "Middle left"
            },
            {
              "value": "justify-center items-center",
              "label": "Middle center"
            },
            {
              "value": "justify-end items-center",
              "label": "Middle right"
            },
            {
              "value": "justify-start items-end",
              "label": "Bottom left"
            },
            {
              "value": "justify-center items-end",
              "label": "Bottom center"
            },
            {
              "value": "justify-end items-end",
              "label": "Bottom right"
            }
          ],
          "default": "justify-center items-center"
        },
        {
          "type": "select",
          "id": "overlay_text_align",
          "label": "Text alignment",
          "options": [
            {
              "value": "text-start",
              "label": "Left"
            },
            {
              "value": "text-center",
              "label": "Center"
            },
            {
              "value": "text-end",
              "label": "Right"
            }
          ],
          "default": "text-center"
        },
        {
          "type": "color_scheme",
          "id": "color_scheme",
          "label": "t:sections.all.colors.label",
          "default": "scheme-1"
        },
        {
          "type": "checkbox",
          "id": "mob_center_text",
          "label": "Center text on mobile",
          "default": false
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading",
          "info": "Shown above the main heading.",
          "default": "LIMITED TIME ONLY"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "info": "Enter <br> for a line-break.",
          "default": "SUPER SALE UPTO 40% OFF"
        },
        {
          "type": "select",
          "id": "heading_size",
          "label": "Heading size",
          "options": [
            {
              "value": "h6",
              "label": "Extra extra small"
            },
            {
              "value": "h5",
              "label": "Extra small"
            },
            {
              "value": "h4",
              "label": "Small"
            },
            {
              "value": "h3",
              "label": "Medium"
            },
            {
              "value": "h2",
              "label": "Large"
            },
            {
              "value": "h1",
              "label": "Extra large"
            },
            {
              "value": "h0",
              "label": "Extra extra large"
            }
          ],
          "default": "h0"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Shop our selection of exclusive handbags and bagpacks at reduced price during the super sale.</p>"
        },
        {
          "type": "text",
          "id": "button_1_label",
          "label": "Button 1 label",
          "default": "Optional button"
        },
        {
          "type": "url",
          "id": "button_1_link",
          "label": "Button 1 link"
        },
    
        {
          "type": "header",
          "content": "Countdown timer"
        },
        {
          "type": "checkbox",
          "id": "countdown_show",
          "label": "Show countdown timer",
          "default": false
        },
        {
          "type": "text",
          "id": "countdown_end_date",
          "label": "End date",
          "info": "Format: YYYY-MM-DD. If you don't enter a date, midnight tonight will be used."
        },
        {
          "type": "text",
          "id": "countdown_end_time",
          "label": "End time (optional)",
          "info": "Format: 17:00 (24 hour clock). Uses the store's timezone."
        },
        {
          "type": "richtext",
          "id": "countdown_end_text",
          "label": "End text",
          "info": "This shows when the date and time elapses."
        },
        {
          "type": "checkbox",
          "id": "enlarge_end_text",
          "label": "Enlarge end text",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "countdown_hide_on_end",
          "label": "Hide the timer when the date and time elapses",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "use_custom_colors",
          "label": "Use custom colors",
          "info": "Uses colors specified below.",
          "default": false
        },
        {
          "type": "color",
          "id": "count_color",
          "label": "Count number",
          "default": "#fff"
        },
        {
          "type": "color",
          "id": "bg_color",
          "label": "Count background/colon",
          "default": "#070707"
        },
        {
          "type": "color_background",
          "id": "bg_grad",
          "label": "Count background gradient",
          "info": "If set, replaces the background color."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Countdown banner",
      "blocks": [
        {
          "type": "banner"
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer", "aside"]
  }
}
{% endschema %}
