<style>
  .recently-viewed-list {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    padding: 0;
    list-style: none;
  }
  .recently-viewed-item {
    width: 120px;
    text-align: center;
  }
  .recently-viewed-item img {
    max-width: 100px;
    height: auto;
    border-radius: 6px;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    {% if product %}
      let product = {
        id: '{{ product.id }}',
        title: {{ product.title | json }},
        url: '{{ product.url }}',
        image: '{{ product.featured_media | image_url: width: 200 }}'
      };
      let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed')) || [];
      recentlyViewed = recentlyViewed.filter(function(item) {
        return item.id != product.id;
      });
      recentlyViewed.unshift(product);
      if (recentlyViewed.length > 5) {
        recentlyViewed = recentlyViewed.slice(0, 5);
      }
      localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
    {% endif %}

    let recentlyViewedContainer = document.getElementById('recently-viewed-products');
    if (recentlyViewedContainer) {
      let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed')) || [];
      if (recentlyViewed.length === 0) {
        recentlyViewedContainer.innerHTML = "<p>No recently viewed products.</p>";
        return;
      }
      recentlyViewedContainer.innerHTML = '<ul class="recently-viewed-list">' +
        recentlyViewed.map(function(item) {
          return `
            <li class="recently-viewed-item">
              <a href="${item.url}">
                <img src="${item.image}" alt="${item.title}">
                <p>${item.title}</p>
              </a>
            </li>
          `;
        }).join('') +
      '</ul>';
    }
  });
</script>